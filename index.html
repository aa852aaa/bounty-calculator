<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¾·å·æ’²å…‹è³é‡‘è¨ˆç®—å™¨</title>
</head>
<body>
  <h1>å¾·å·æ’²å…‹è³é‡‘è¨ˆç®—å™¨</h1>

  <label for="modeSelect">é¸æ“‡æ¯”è³½æ¨¡å¼ï¼š</label>
  <select id="modeSelect" onchange="updateModeForm()">
    <option value="KO">KO</option>
    <option value="PKO">PKO</option>
    <option value="Mystery">Mystery</option>
  </select>
  <br><br>

  <label for="startingChips">èµ·å§‹ç±Œç¢¼ï¼š</label>
  <input type="number" id="startingChips" placeholder="ä¾‹å¦‚ 30000"><br><br>

  <label for="totalPlayers">ç¸½åƒè³½äººæ•¸ï¼š</label>
  <input type="number" id="totalPlayers" placeholder="ä¾‹å¦‚ 331"><br><br>

  <label for="remainingPlayers">ç›®å‰å‰©é¤˜äººæ•¸ï¼š</label>
  <input type="number" id="remainingPlayers" placeholder="ä¾‹å¦‚ 5"><br><br>

  <label for="payoutStructure">åæ¬¡çé‡‘çµæ§‹ï¼ˆæ ¼å¼ï¼šåæ¬¡:é‡‘é¡ï¼Œæ¯è¡Œä¸€ç­†ï¼‰ï¼š</label><br>
  <textarea id="payoutStructure" rows="10" cols="30" placeholder="1:20333&#10;2:15247&#10;4:8574"></textarea><br><br>

  <div id="modeSpecificInputs"></div>

  <button onclick="processInputs()">é€å‡º</button>

  <h2>ğŸ” çµæœï¼š</h2>
  <pre id="output"></pre>

  <script>
    function updateModeForm() {
      const mode = document.getElementById("modeSelect").value;
      const container = document.getElementById("modeSpecificInputs");
      container.innerHTML = "";

      if (mode === "KO") {
        container.innerHTML = `
          <label>æ¯æ¬¡æ“Šæ®ºçé‡‘ï¼ˆ$ï¼‰ï¼š</label>
          <input type="number" id="koBounty" placeholder="ä¾‹å¦‚ 50"><br><br>
        `;
      } else if (mode === "PKO") {
        container.innerHTML = `
          <label>èµ·å§‹è³é‡‘ï¼ˆ$ï¼‰ï¼š</label>
          <input type="number" id="startingBounty" placeholder="ä¾‹å¦‚ 50"><br><br>
          <label>è‡ªå·±æ¯æ¬¡æ“Šæ®ºå¯å¾—æ¯”ä¾‹ï¼ˆ%ï¼‰ï¼š</label>
          <input type="number" id="bountyShare" value="50"><br><br>
        `;
      } else if (mode === "Mystery") {
        container.innerHTML = `
          <label>å·²ç²å¾—ç¥ç§˜è³é‡‘ç¸½é¡ï¼ˆ$ï¼‰ï¼š</label>
          <input type="number" id="mysteryTotal"><br><br>
        `;
      }
    }

    function processInputs() {
      const mode = document.getElementById("modeSelect").value;
      const chips = parseInt(document.getElementById("startingChips").value);
      const players = parseInt(document.getElementById("totalPlayers").value);
      const remainingPlayers = parseInt(document.getElementById("remainingPlayers").value);
      const payoutText = document.getElementById("payoutStructure").value;

      // Step 1: è§£æåæ¬¡çé‡‘
      let rawPayouts = [];
      payoutText.split('\n').forEach(line => {
        const [place, amount] = line.split(':');
        if (place && amount) {
          const rank = parseInt(place.trim());
          const money = parseFloat(amount.replace(/,/g, '').trim());
          rawPayouts.push({ rank, money });
        }
      });

      rawPayouts.sort((a, b) => a.rank - b.rank);

      let payouts = {};
      let lastAmount = 0;
      let current = 1;

      for (let i = 0; i < rawPayouts.length; i++) {
        const { rank, money } = rawPayouts[i];
        while (current < rank) {
          payouts[current] = lastAmount;
          current++;
        }
        payouts[rank] = money;
        lastAmount = money;
        current = rank + 1;
      }

      while (current <= players) {
        payouts[current] = lastAmount;
        current++;
      }

      // Step 2: è¨ˆç®—å‰©é¤˜åæ¬¡çé‡‘ï¼ˆå¯è®ŠåŒ–éƒ¨åˆ†ï¼‰
      let remainingPrizeTotal = 0;
      let lockedAmount = payouts[remainingPlayers] || 0;

      for (let i = 1; i <= remainingPlayers; i++) {
        remainingPrizeTotal += payouts[i];
      }

      let dynamicPrizePool = remainingPrizeTotal - (lockedAmount * remainingPlayers);
      if (dynamicPrizePool < 0) dynamicPrizePool = 0;

      // Step 3: è¼¸å‡ºçµæœ
      let result = `ğŸ¯ æ¨¡å¼ï¼š${mode}\nèµ·å§‹ç±Œç¢¼ï¼š${chips}\nç¸½äººæ•¸ï¼š${players}\nç›®å‰å‰©é¤˜äººæ•¸ï¼š${remainingPlayers}`;
      result += `\n\nğŸ† åæ¬¡çé‡‘ï¼ˆå‰ 10 åï¼‰ï¼š\n`;

      for (let i = 1; i <= Math.min(10, players); i++) {
        result += `ç¬¬ ${i} åï¼š$${payouts[i].toLocaleString()}\n`;
      }

      result += `\nğŸ§® å‰©é¤˜åæ¬¡çé‡‘ç¸½é¡ï¼ˆå¯è®ŠåŒ–éƒ¨åˆ†ï¼‰ï¼š$${dynamicPrizePool.toLocaleString()}`;

      document.getElementById("output").innerText = result;
    }

    window.onload = updateModeForm;
  </script>
</body>
</html>
